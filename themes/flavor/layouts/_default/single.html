{{ define "main" }}

<article class="article" itemscope itemtype="https://schema.org/Article">
  
  {{/* Hero de l'article */}}
  <header class="article__header">
    <div class="article__header-container">
      
      {{/* Breadcrumb */}}
      <nav class="article__breadcrumb" aria-label="Fil d'Ariane">
        <a href="/" class="article__breadcrumb-link">Accueil</a>
        <span class="article__breadcrumb-sep">/</span>
        {{ with .CurrentSection }}
        <a href="{{ .Permalink }}" class="article__breadcrumb-link">{{ .Title }}</a>
        <span class="article__breadcrumb-sep">/</span>
        {{ end }}
        <span class="article__breadcrumb-current">{{ .Title | truncate 40 }}</span>
      </nav>
      
      {{/* Catégorie */}}
      {{ with .Params.categories }}
      <div class="article__categories">
        {{ range . }}
        <a href="{{ "/categories/" | relLangURL }}{{ . | urlize }}/" class="article__category">{{ . }}</a>
        {{ end }}
      </div>
      {{ end }}
      
      {{/* Titre */}}
      <h1 class="article__title" itemprop="headline">{{ .Title }}</h1>
      
      {{/* Meta */}}
      <div class="article__meta">
        <time class="article__date" datetime="{{ .Date.Format "2006-01-02" }}" itemprop="datePublished">
          {{ .Date.Format "2 January 2006" }}
        </time>
        <span class="article__reading-time">
          {{ $wordCount := .WordCount }}
          {{ $readingTime := div $wordCount 200 }}
          {{ if lt $readingTime 1 }}1{{ else }}{{ $readingTime }}{{ end }} min de lecture
        </span>
      </div>
      
    </div>
  </header>
  
  {{/* Image principale - toujours via le partial */}}
  <figure class="article__hero-image">
    <img 
      src="{{ partial "image.html" (dict "page" . "width" 1200 "height" 600 "context" "hero") }}" 
      alt="{{ .Title }}" 
      class="article__hero-img"
      loading="eager"
      itemprop="image"
    >
  </figure>
  
  {{/* Contenu principal */}}
  <div class="article__body">
    <div class="article__container">
      
      {{/* Contenu */}}
      <div class="article__content prose" itemprop="articleBody">
        {{ .Content }}
      </div>
      
      {{/* Sidebar */}}
      <aside class="article__sidebar">
        
        {{/* Table des matières */}}
        {{ if .TableOfContents }}
        <nav class="article__toc">
          <h3 class="article__toc-title">Sommaire</h3>
          {{ .TableOfContents }}
        </nav>
        {{ end }}
        
        {{/* Tags */}}
        {{ with .Params.tags }}
        <div class="article__tags">
          <h3 class="article__tags-title">Thèmes abordés</h3>
          <ul class="article__tags-list">
            {{ range . }}
            <li><a href="{{ "/tags/" | relLangURL }}{{ . | urlize }}/" class="article__tag">{{ . }}</a></li>
            {{ end }}
          </ul>
        </div>
        {{ end }}
        
        {{/* Articles similaires */}}
        {{ $related := .Site.RegularPages.Related . | first 3 }}
        {{ with $related }}
        <div class="article__related">
          <h3 class="article__related-title">Articles similaires</h3>
          <ul class="article__related-list">
            {{ range . }}
            <li class="article__related-item">
              <a href="{{ .Permalink }}" class="article__related-link">
                <span class="article__related-text">{{ .Title }}</span>
              </a>
            </li>
            {{ end }}
          </ul>
        </div>
        {{ end }}
        
      </aside>
      
    </div>
  </div>
  
  {{/* Navigation articles */}}
  <nav class="article__nav" aria-label="Navigation articles">
    <div class="article__nav-container">
      {{ with .PrevInSection }}
      <a href="{{ .Permalink }}" class="article__nav-link article__nav-link--prev">
        <span class="article__nav-label">Article précédent</span>
        <span class="article__nav-title">{{ .Title | truncate 50 }}</span>
      </a>
      {{ end }}
      {{ with .NextInSection }}
      <a href="{{ .Permalink }}" class="article__nav-link article__nav-link--next">
        <span class="article__nav-label">Article suivant</span>
        <span class="article__nav-title">{{ .Title | truncate 50 }}</span>
      </a>
      {{ end }}
    </div>
  </nav>
  
</article>

{{ end }}
